import{j as e,T as y,r as I,i as v,f as E,M as Q,v as B,F,I as A,C,S as M,g as P,h as z,u as D,p as T,k as O,l as q,m as R,n as W,b as V,o as K,q as L,s as U,t as $,B as k}from"./index-B_SK9RNk.js";import{I as G,a as H,T as b,u as J}from"./useGetAllCollections-CdK_rdgE.js";const X=({register:t,errors:s})=>{var n;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Inventory"}),e.jsx(y,{label:"Stock Quantity",variant:"outlined",size:"small",fullWidth:!0,type:"string",inputMode:"numeric",placeholder:"Enter quantity",...t("stockQuantity"),error:!!s.stockQuantity,helperText:(n=s.stockQuantity)==null?void 0:n.message})]})},Y=({register:t,errors:s,setValue:n})=>{var a;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Pricing"}),e.jsx(y,{label:"Price",variant:"outlined",size:"small",fullWidth:!0,slotProps:{input:{startAdornment:e.jsx(G,{position:"start",children:"â‚±"})}},placeholder:"Enter price",error:!!s.price,helperText:(a=s.price)==null?void 0:a.message,...t("price",{onBlur:o=>{const c=o.target.value,d=/^\d+(\.\d{1,2})?$/.test(c);if(c&&d&&!c.includes(".")){const m=`${c}.00`;o.target.value=m,n("price",m,{shouldValidate:!0})}}})})]})},S=({getRootProps:t,getInputProps:s})=>e.jsxs("div",{...t(),className:"w-20 border-2 border-dashed border-gray-300 p-5 cursor-pointer rounded-md flex items-center justify-center text-3xl hover:bg-gray-200",children:[e.jsx("input",{...s()}),e.jsx(H,{})]}),Z=({files:t,handleRemoveImageFromFiles:s})=>e.jsx("div",{className:"overflow-y-auto h-full grid grid-cols-4 gap-5 p-4",children:t.map(n=>e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-32 object-cover rounded-md",src:n.preview,alt:"Preview"}),e.jsx("button",{onClick:()=>s(n.name),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer",children:e.jsx(b,{})})]},n.name))}),_=()=>{const[t,s]=I.useState(!1),n=()=>s(!1),a=v(r=>r.images),o=v(r=>r.setImages),c=v(r=>r.removeImage),[d,m]=I.useState(""),{getRootProps:x,getInputProps:i}=E({accept:{"image/*":[]},multiple:!0,maxSize:10*1024*1024,onDrop:(r,l)=>{l.length>0&&m("Some files were rejected. Ensure they are images and under 10MB.");const f=r.map(h=>Object.assign(h,{preview:URL.createObjectURL(h)})).filter(h=>!a.some(j=>j.name===h.name));o([...a,...f])}}),g=r=>{c(r)},p=a.length===1,w=a.length>1&&a.length<9,N=a.length>=9;return e.jsxs("div",{children:[e.jsx("p",{children:"Media: "}),e.jsxs("div",{className:"flex h-full flex-col gap-4",children:[a.length===0&&e.jsxs("div",{...x(),className:"border-2 border-dashed border-gray-300 p-5 cursor-pointer rounded-md text-center",children:[e.jsx("input",{...i(),accept:"image/*",max:"10485760"}),e.jsx("p",{className:"text-center",children:"Add at least 3 pictures"})]}),d&&e.jsx("p",{className:"text-red-500 italic text-center",children:d}),a.length>0&&e.jsxs("div",{className:"flex gap-2 h-50",children:[a.map((r,l)=>l===0&&e.jsxs("div",{className:"w-50 relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:r.preview,alt:"Preview"}),e.jsx("button",{onClick:()=>g(r.name),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer",children:e.jsx(b,{})})]},r.name)),p&&e.jsx("div",{children:e.jsx(S,{getRootProps:x,getInputProps:i})}),w&&e.jsxs("div",{className:"flex-1 grid grid-cols-4 grid-rows-2 gap-2",children:[a.map((r,l)=>l===0?null:e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:r.preview,alt:"Preview"}),e.jsx("button",{onClick:()=>g(r.name),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer hover:bg-gray-200 ",children:e.jsx(b,{})})]},r.name)),e.jsx(S,{getRootProps:x,getInputProps:i})]}),N&&e.jsxs("div",{className:"flex-1 grid grid-cols-4 grid-rows-2 gap-3",children:[a.map((r,l)=>l===0||l>=8?null:l===7?e.jsxs("div",{className:"w-full relative border rounded-md border-gray-300 cursor-pointer",onClick:()=>s(!0),children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md blur-sm opacity-60",src:r.preview,alt:"Preview"}),e.jsxs("span",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2  text-2xl",children:["+",a.length-7]})]},r.name):e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:r.preview,alt:"Preview"}),e.jsx("button",{onClick:()=>g(r.name),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer hover:bg-gray-200 ",children:e.jsx(b,{})})]},r.name)),e.jsx(S,{getRootProps:x,getInputProps:i})]})]})]}),e.jsx(Q,{open:t,onClose:n,style:B.style,children:e.jsx(Z,{files:a,handleRemoveImageFromFiles:g})})]})},ee=({register:t,errors:s,control:n,collections:a})=>{var o,c,d,m;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Product Details"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(y,{fullWidth:!0,label:"Name",size:"small",variant:"outlined",...t("name"),error:!!s.name,helperText:(o=s.name)==null?void 0:o.message}),e.jsx(y,{label:"Description",size:"small",multiline:!0,rows:4,...t("description"),error:!!s.description,helperText:(c=s.description)!=null&&c.message?String((d=s.description)==null?void 0:d.message):""}),e.jsx(_,{}),e.jsxs(F,{fullWidth:!0,size:"small",error:!!s.category,children:[e.jsx(A,{error:!!s.category,children:"Category"}),e.jsx(C,{name:"category",control:n,render:({field:x})=>e.jsx(M,{labelId:"select-labesl",label:"Category",...x,variant:"outlined",children:a.map(i=>e.jsx(P,{value:i.id,children:i.name},i.id))})}),e.jsx(z,{children:((m=s.category)==null?void 0:m.message)||""})]})]})]})},se=({errors:t,control:s})=>{var n;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Status"}),e.jsxs(F,{fullWidth:!0,size:"small",error:!!t.status,children:[e.jsx(A,{error:!!t.status,children:"Status"}),e.jsx(C,{name:"status",control:s,render:({field:a})=>e.jsxs(M,{labelId:"select-labesl",label:"Status",...a,variant:"outlined",children:[e.jsx(P,{value:"Active",children:"Active"}),e.jsx(P,{value:"Inactive",children:"Inactive"})]})}),e.jsx(z,{children:((n=t.status)==null?void 0:n.message)||""})]})]})},re=()=>{const{mutateAsync:t,isPending:s,isError:n,error:a,isSuccess:o}=D({mutationFn:T.addProduct});return{addProduct:t,isPending:s,isError:n,error:a,isSuccess:o}},te=({control:t})=>e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Featured Product"}),e.jsx(C,{name:"featured",control:t,render:({field:s})=>e.jsx(O,{...s,checked:s.value,icon:e.jsx("p",{className:"text-3xl",children:e.jsx(R,{})}),checkedIcon:e.jsx("p",{className:"text-3xl",children:e.jsx(q,{})})})})]})}),oe=()=>{const t=W(),{collections:s}=J(),n=V(),a=v(l=>l.images),o=v(l=>l.clearImages),c=K(l=>l.setOpenSnackBar),{register:d,handleSubmit:m,setError:x,control:i,setValue:g,formState:{errors:p}}=L({resolver:U($),defaultValues:{featured:!1,category:"",status:"Active"}}),{addProduct:w,isPending:N}=re(),r=async l=>{var f,h;const u=new FormData;a.forEach(j=>{u.append("image",j)}),u.append("name",l.name),u.append("description",l.description),u.append("status",l.status),u.append("featured",l.featured.toString()),u.append("price",l.price),u.append("category",l.category),u.append("stockQuantity",String(l.stockQuantity));try{await w(u),await t.invalidateQueries({queryKey:["products"]}),await t.invalidateQueries({queryKey:["featuredProducts"]}),await t.invalidateQueries({queryKey:["collections"]}),c(!0),n("/products")}catch(j){x("root",{message:((h=(f=j.response)==null?void 0:f.data)==null?void 0:h.error)||"An unexpected error occurred"})}};return I.useEffect(()=>()=>{o()},[o]),s.length===0?e.jsxs("div",{className:"border border-gray-300 shadow-md rounded-lg p-8 text-center mt-10 text-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No collections found"}),e.jsx("p",{className:"mb-4",children:"Please create a collection before adding a product."}),e.jsx(k,{variant:"contained",color:"ashblack",onClick:()=>n("/collections/addcollection"),children:"Create Collection"})]}):e.jsxs("form",{className:"w-full flex gap-5 justify-center",onSubmit:m(r),children:[e.jsxs("div",{className:"w-1/2 flex flex-col gap-4",children:[e.jsx(ee,{register:d,errors:p,control:i,collections:s}),e.jsx(X,{register:d,errors:p})]}),e.jsxs("div",{className:"w-1/3 flex flex-col gap-4",children:[e.jsx(te,{control:i}),e.jsx(se,{errors:p,control:i}),e.jsx(Y,{register:d,errors:p,setValue:g}),e.jsx(k,{type:"submit",variant:"contained",size:"small",color:"primary",loading:N,children:"Save"}),p.root&&e.jsx("div",{className:"text-center text-red-600 ",children:p.root.message})]})]})};export{oe as default};
