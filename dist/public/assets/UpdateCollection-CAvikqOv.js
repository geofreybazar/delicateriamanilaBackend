import{g as I,h as E,u as O,i as Q,b as K,k as L,O as R,r as m,l as T,m as A,n as M,o as G,j as e,T as S,B as C,N as V}from"./index-vQs_jjn0.js";import{_ as W}from"./lodash-BHMADSfv.js";const _=i=>{const{data:t,isLoading:a,isError:r,error:n}=I({queryKey:["collection",i],queryFn:()=>E.getCollection(i)});return{collection:t,isLoading:a,isError:r,error:n}},$=()=>{const{mutateAsync:i,isPending:t,isError:a,error:r,isSuccess:n}=O({mutationFn:({id:p,body:x})=>E.upateCollection(p,x)});return{updateCollection:i,isPending:t,isError:a,error:r,isSuccess:n}},Y=()=>{var y,N,w;const{id:i}=Q(),t=K(),a=L(),{collection:r}=_(i||""),{updateCollection:n,isPending:p}=$(),x=R(s=>s.setOpenSnackBar),[f,P]=m.useState(""),[c,U]=m.useState([]),[h,j]=m.useState("");m.useEffect(()=>{const s=c.length!==0?c[0].preview:r.image.url;P(s)},[c,r]);const v={name:r.name,description:r.description},{register:b,handleSubmit:F,setError:k,formState:{errors:o}}=T({resolver:A(M),defaultValues:v}),{getRootProps:z,getInputProps:q}=G({accept:{"image/*":[]},multiple:!0,maxSize:10*1024*1024,maxFiles:1,onDrop:(s,l)=>{j(""),l.length>0&&j("Image was rejected. Ensure image is under 10MB.");const u=s.map(d=>Object.assign(d,{preview:URL.createObjectURL(d)}));U(u)}}),B=async s=>{var u,d;if(W.isEqual(s,v)&&c.length===0){t("/collections");return}const l=new FormData;c.forEach(g=>{l.append("image",g)}),l.append("name",s.name),l.append("description",s.description),l.append("imageUrl",f);try{await n({id:r.id,body:l}),await a.invalidateQueries({queryKey:["collection",r.id]}),await a.invalidateQueries({queryKey:["collections"],exact:!1}),await a.invalidateQueries({queryKey:["products"],exact:!1}),x(!0),t("/collections")}catch(g){k("root",{message:((d=(u=g.response)==null?void 0:u.data)==null?void 0:d.error)||"An unexpected error occurred"})}},D=s=>{t(`/products/updateproduct/${s}`)};return e.jsxs("div",{className:"w-full flex flex-col items-center gap-5 overflow-auto",children:[e.jsxs("form",{className:"h-full w-full px-4 flex gap-5 justify-center overflow-auto",onSubmit:F(B),children:[e.jsxs("div",{className:"w-1/2 flex flex-col gap-4",children:[e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Product Details"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(S,{fullWidth:!0,label:"Name",size:"small",variant:"outlined",...b("name"),error:!!o.name,helperText:(y=o.name)==null?void 0:y.message}),e.jsx(S,{label:"Description",size:"small",multiline:!0,rows:4,...b("description"),error:!!o.description,helperText:(N=o.description)!=null&&N.message?String((w=o.description)==null?void 0:w.message):""})]})]}),e.jsx(C,{type:"submit",variant:"contained",size:"small",color:"primary",loading:p,children:"Save"}),o.root&&e.jsx("div",{className:"text-center text-red-600 ",children:o.root.message})]}),e.jsxs("div",{className:"w-1/4 flex flex-col p-4 border border-gray-300 rounded-lg shadow-lg overflow-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Collection Image "}),e.jsxs("div",{...z(),className:"cursor-pointer px-2 rounded-md hover:bg-gray-100 transition",children:[e.jsx("input",{...q(),accept:"image/*",max:"10485760"}),e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Change Image"})]})]}),e.jsx("div",{className:"flex-1",children:e.jsx("img",{className:"h-full w-full rounded-md object-cover",src:f,alt:"Preview"})}),h&&e.jsx("p",{className:"text-red-500 italic text-center",children:h})]})]}),e.jsxs("div",{className:"w-3/4 flex flex-col p-4 border border-gray-300 rounded-lg shadow-lg",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Products "}),e.jsx("div",{className:"flex-1",children:r.products.length===0?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center",children:[e.jsx("p",{children:"No Product listed"}),e.jsx(V,{to:"/products/addproduct",children:e.jsx(C,{variant:"contained",size:"small",color:"ashblack",children:"Add Product"})})]}):e.jsx("ol",{className:"list-decimal list-inside flex flex-col",children:r.products.map(s=>e.jsx("li",{onClick:()=>D(s.id),className:"transition duration-200 ease-in-out hover:bg-gray-100 p-2 rounded-md cursor-pointer",children:s.name},s.name))})})]})]})};export{Y as default};
