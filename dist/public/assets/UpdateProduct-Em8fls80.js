import{w as L,p as O,u as G,j as e,r as N,i as f,R as w,f as J,M as $,v as H,T as S,F as B,I as D,C as M,S as T,g as _,h as K,k as X,l as Y,m as Z,U as ee,n as se,b as re,V as te,q as ae,s as ne,t as le,B as ie,_ as A}from"./index-B_SK9RNk.js";import{a as oe,T as I,I as ce,u as de}from"./useGetAllCollections-CdK_rdgE.js";const ue=n=>{const{data:r,isLoading:a,isSuccess:c,isError:i,error:o}=L({queryKey:["product",n],queryFn:()=>O.getProduct(n)});return{product:r,isSuccess:c,isLoading:a,isError:i,error:o}},me=()=>{const{mutateAsync:n,isPending:r,isError:a,error:c,isSuccess:i}=G({mutationFn:({id:o,data:u})=>O.updateProduct(o,u)});return{update:n,isPending:r,isError:a,error:c,isSuccess:i}},Q=({getRootProps:n,getInputProps:r})=>e.jsxs("div",{...n(),className:"w-20 border-2 border-dashed border-gray-300 p-5 cursor-pointer rounded-md flex items-center justify-center text-3xl hover:bg-gray-200",children:[e.jsx("input",{...r()}),e.jsx(oe,{})]}),pe=({combinedImages:n,handleRemoveImageFromFiles:r})=>e.jsx("div",{className:"overflow-y-auto h-full grid grid-cols-4 gap-5 p-4",children:n.map(a=>e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-32 object-cover rounded-md",src:"preview"in a?a.preview:a.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsx("button",{onClick:()=>r(a),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer",children:e.jsx(I,{})})]},"name"in a?a.name:a._id))}),xe=()=>{const[n,r]=N.useState(!1),[a,c]=N.useState(""),i=f(s=>s.images),o=f(s=>s.setImages),u=f(s=>s.removeImage),p=w(s=>s.images),b=w(s=>s.removeInitialImage),t=[...p,...i],{getRootProps:j,getInputProps:v}=J({accept:{"image/*":[]},multiple:!0,maxSize:10*1024*1024,onDrop:(s,d)=>{d.length>0&&c("Some files were rejected. Ensure they are images and under 10MB.");const k=s.map(l=>Object.assign(l,{preview:URL.createObjectURL(l)})).filter(l=>!i.some(E=>E.name===l.name));o([...i,...k])}}),P=()=>r(!1),g=s=>{"name"in s?u(s.name):b(s.publicId)},y=t.length===1,C=t.length>1&&t.length<9,F=t.length>=9;return e.jsxs("div",{children:[e.jsx("p",{children:"Media: "}),e.jsxs("div",{className:"flex h-full flex-col gap-4",children:[t.length===0&&e.jsxs("div",{...j(),className:"border-2 border-dashed border-gray-300 p-5 cursor-pointer rounded-md text-center",children:[e.jsx("input",{...v(),accept:"image/*",max:"10485760"}),e.jsx("p",{className:"text-center",children:"Add at least 3 pictures"})]}),a&&e.jsx("p",{className:"text-red-500 italic text-center",children:a}),t.length>0&&e.jsxs("div",{className:"flex gap-2 h-50",children:[t.map((s,d)=>d===0&&e.jsxs("div",{className:"w-50 relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:"preview"in s?s.preview:s.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsx("button",{onClick:()=>g(s),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer",children:e.jsx(I,{})})]},"name"in s?s.name:s._id)),y&&e.jsx("div",{children:e.jsx(Q,{getRootProps:j,getInputProps:v})}),C&&e.jsxs("div",{className:"flex-1 grid grid-cols-4 grid-rows-2 gap-2",children:[t.map((s,d)=>d===0?null:e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:"preview"in s?s.preview:s.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsx("button",{onClick:()=>g(s),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer hover:bg-gray-200 ",children:e.jsx(I,{})})]},"name"in s?s.name:s._id)),e.jsx(Q,{getRootProps:j,getInputProps:v})]}),F&&e.jsxs("div",{className:"flex-1 grid grid-cols-4 grid-rows-2 gap-3",children:[t.map((s,d)=>d===0||d>=8?null:d===7?e.jsxs("div",{className:"w-full relative border rounded-md border-gray-300 cursor-pointer",onClick:()=>r(!0),children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md blur-sm opacity-60",src:"preview"in s?s.preview:s.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsxs("span",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2  text-2xl",children:["+",t.length-7]})]},"name"in s?s.name:s._id):e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:"preview"in s?s.preview:s.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsx("button",{onClick:()=>g(s),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer hover:bg-gray-200 ",children:e.jsx(I,{})})]},"name"in s?s.name:s._id)),e.jsx(Q,{getRootProps:j,getInputProps:v})]})]})]}),e.jsx($,{open:n,onClose:P,style:H.style,children:e.jsx(pe,{combinedImages:t,handleRemoveImageFromFiles:g})})]})},ge=({register:n,errors:r,control:a,collections:c})=>{var i,o,u,p;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Product Details"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(S,{fullWidth:!0,label:"Name",size:"small",variant:"outlined",...n("name"),error:!!r.name,helperText:(i=r.name)==null?void 0:i.message}),e.jsx(S,{label:"Description",size:"small",multiline:!0,rows:4,...n("description"),error:!!r.description,helperText:(o=r.description)!=null&&o.message?String((u=r.description)==null?void 0:u.message):""}),e.jsx(xe,{}),e.jsxs(B,{fullWidth:!0,size:"small",error:!!r.category,children:[e.jsx(D,{error:!!r.category,children:"Category"}),e.jsx(M,{name:"category",control:a,render:({field:b})=>e.jsx(T,{labelId:"select-labesl",label:"Category",...b,variant:"outlined",children:c.map(t=>e.jsx(_,{value:t.id,children:t.name},t.id))})}),e.jsx(K,{children:((p=r.category)==null?void 0:p.message)||""})]})]})]})},he=({register:n,errors:r})=>{var a;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Inventory"}),e.jsx(S,{label:"Stock Quantity",variant:"outlined",size:"small",fullWidth:!0,type:"string",inputMode:"numeric",placeholder:"Enter quantity",...n("stockQuantity"),error:!!r.stockQuantity,helperText:(a=r.stockQuantity)==null?void 0:a.message})]})},je=({errors:n,control:r})=>{var a;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Status"}),e.jsxs(B,{fullWidth:!0,size:"small",error:!!n.status,children:[e.jsx(D,{error:!!n.status,children:"Status"}),e.jsx(M,{name:"status",control:r,render:({field:c})=>e.jsxs(T,{labelId:"select-labesl",label:"Status",...c,variant:"outlined",children:[e.jsx(_,{value:"Active",children:"Active"}),e.jsx(_,{value:"Inactive",children:"Inactive"})]})}),e.jsx(K,{children:((a=n.status)==null?void 0:a.message)||""})]})]})},ve=({register:n,errors:r,setValue:a})=>{var c;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Pricing"}),e.jsx(S,{label:"Price",variant:"outlined",size:"small",fullWidth:!0,slotProps:{input:{startAdornment:e.jsx(ce,{position:"start",children:"â‚±"})}},placeholder:"Enter price",error:!!r.price,helperText:(c=r.price)==null?void 0:c.message,...n("price",{onBlur:i=>{const o=i.target.value,u=/^\d+(\.\d{1,2})?$/.test(o);if(o&&u&&!o.includes(".")){const p=`${o}.00`;i.target.value=p,a("price",p,{shouldValidate:!0})}}})})]})},be=({control:n})=>e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Featured Product"}),e.jsx(M,{name:"featured",control:n,render:({field:r})=>e.jsx(X,{...r,checked:r.value,icon:e.jsx("p",{className:"text-3xl",children:e.jsx(Z,{})}),checkedIcon:e.jsx("p",{className:"text-3xl",children:e.jsx(Y,{})})})})]})}),Ie=()=>{const{id:n}=ee(),r=se(),a=re(),c=f(l=>l.images),i=f(l=>l.clearImages),o=w(l=>l.images),u=w(l=>l.setInitialImages),p=w(l=>l.clearInitialImages),{collections:b}=de(),{product:t}=ue(n||""),{update:j,isPending:v}=me(),P=te(l=>l.setOpenSnackBar);N.useEffect(()=>{u(t.images)},[t]);const g={name:t.name,description:t.description,category:t.category.id,price:JSON.stringify(t.price),status:t.status,stockQuantity:JSON.stringify(t.stockQuantity),featured:t.featured},{register:y,handleSubmit:C,setError:F,control:s,setValue:d,formState:{errors:h}}=ae({resolver:ne(le),defaultValues:g}),k=async l=>{var q,z;const E=!A.isEqual(g,l),R=t.images.map(x=>x.publicId).sort(),U=o.map(x=>x.publicId).sort(),V=!A.isEqual(R,U),W=c.length>0;if(!E&&!V&&!W){a("/products");return}const m=new FormData;c.forEach(x=>{m.append("image",x)}),o.forEach(x=>{m.append("images",x.publicId)}),m.append("name",l.name),m.append("description",l.description),m.append("featured",l.featured.toString()),m.append("status",l.status),m.append("price",l.price),m.append("category",l.category),m.append("stockQuantity",String(l.stockQuantity));try{await j({id:t.id,data:m}),await r.invalidateQueries({queryKey:["product",n]}),await r.invalidateQueries({queryKey:["products"]}),await r.invalidateQueries({queryKey:["featuredProducts"]}),await r.invalidateQueries({queryKey:["collections"]}),await r.invalidateQueries({queryKey:["collection",l.category]}),await r.invalidateQueries({queryKey:["collection",t.category]}),P(!0),a("/products")}catch(x){F("root",{message:((z=(q=x.response)==null?void 0:q.data)==null?void 0:z.error)||"An unexpected error occurred"})}};return N.useEffect(()=>()=>{i(),p()},[i]),e.jsxs("form",{className:"w-full flex gap-5 justify-center",onSubmit:C(k),children:[e.jsxs("div",{className:"w-1/2 flex flex-col gap-4",children:[e.jsx(ge,{register:y,errors:h,control:s,collections:b}),e.jsx(he,{register:y,errors:h})]}),e.jsxs("div",{className:"w-1/3 flex flex-col gap-4",children:[e.jsx(be,{control:s}),e.jsx(je,{errors:h,control:s}),e.jsx(ve,{register:y,errors:h,setValue:d}),e.jsx(ie,{type:"submit",variant:"contained",size:"small",color:"primary",loading:v,children:"Save"}),h.root&&e.jsx("div",{className:"text-center text-red-600 ",children:h.root.message})]})]})};export{Ie as default};
