import{s as L,p as D,u as G,j as e,r as N,Q as y,aT as w,B as J,P as $,v as H,C as S,R as O,S as B,F as M,V as T,M as _,W as K,X,Y,Z,w as ee,g as se,b as re,aU as te,x as ae,y as le,a0 as ne,D as ie}from"./index-D1os0LSF.js";import{I as oe,T as I,u as ce}from"./useGetAllCollections-BCUxWnGR.js";import{I as de}from"./InputAdornment-DMY7Iu_P.js";import{_ as A}from"./lodash-z1zNZ8R8.js";import"./Typography-C35Fcnlr.js";const ue=l=>{const{data:r,isLoading:a,isSuccess:c,isError:i,error:o}=L({queryKey:["product",l],queryFn:()=>D.getProduct(l)});return{product:r,isSuccess:c,isLoading:a,isError:i,error:o}},me=()=>{const{mutateAsync:l,isPending:r,isError:a,error:c,isSuccess:i}=G({mutationFn:({id:o,data:u})=>D.updateProduct(o,u)});return{update:l,isPending:r,isError:a,error:c,isSuccess:i}},Q=({getRootProps:l,getInputProps:r})=>e.jsxs("div",{...l(),className:"w-20 border-2 border-dashed border-gray-300 p-5 cursor-pointer rounded-md flex items-center justify-center text-3xl hover:bg-gray-200",children:[e.jsx("input",{...r()}),e.jsx(oe,{})]}),pe=({combinedImages:l,handleRemoveImageFromFiles:r})=>e.jsx("div",{className:"overflow-y-auto h-full grid grid-cols-4 gap-5 p-4",children:l.map(a=>e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-32 object-cover rounded-md",src:"preview"in a?a.preview:a.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsx("button",{onClick:()=>r(a),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer",children:e.jsx(I,{})})]},"name"in a?a.name:a._id))}),xe=()=>{const[l,r]=N.useState(!1),[a,c]=N.useState(""),i=y(s=>s.images),o=y(s=>s.setImages),u=y(s=>s.removeImage),p=w(s=>s.images),b=w(s=>s.removeInitialImage),t=[...p,...i],{getRootProps:j,getInputProps:v}=J({accept:{"image/*":[]},multiple:!0,maxSize:10*1024*1024,onDrop:(s,d)=>{d.length>0&&c("Some files were rejected. Ensure they are images and under 10MB.");const k=s.map(n=>Object.assign(n,{preview:URL.createObjectURL(n)})).filter(n=>!i.some(E=>E.name===n.name));o([...i,...k])}}),P=()=>r(!1),g=s=>{"name"in s?u(s.name):b(s.publicId)},f=t.length===1,C=t.length>1&&t.length<9,F=t.length>=9;return e.jsxs("div",{children:[e.jsx("p",{children:"Media: "}),e.jsxs("div",{className:"flex h-full flex-col gap-4",children:[t.length===0&&e.jsxs("div",{...j(),className:"border-2 border-dashed border-gray-300 p-5 cursor-pointer rounded-md text-center",children:[e.jsx("input",{...v(),accept:"image/*",max:"10485760"}),e.jsx("p",{className:"text-center",children:"Add at least 3 pictures"})]}),a&&e.jsx("p",{className:"text-red-500 italic text-center",children:a}),t.length>0&&e.jsxs("div",{className:"flex gap-2 h-50",children:[t.map((s,d)=>d===0&&e.jsxs("div",{className:"w-50 relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:"preview"in s?s.preview:s.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsx("button",{onClick:()=>g(s),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer",children:e.jsx(I,{})})]},"name"in s?s.name:s._id)),f&&e.jsx("div",{children:e.jsx(Q,{getRootProps:j,getInputProps:v})}),C&&e.jsxs("div",{className:"flex-1 grid grid-cols-4 grid-rows-2 gap-2",children:[t.map((s,d)=>d===0?null:e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:"preview"in s?s.preview:s.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsx("button",{onClick:()=>g(s),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer hover:bg-gray-200 ",children:e.jsx(I,{})})]},"name"in s?s.name:s._id)),e.jsx(Q,{getRootProps:j,getInputProps:v})]}),F&&e.jsxs("div",{className:"flex-1 grid grid-cols-4 grid-rows-2 gap-3",children:[t.map((s,d)=>d===0||d>=8?null:d===7?e.jsxs("div",{className:"w-full relative border rounded-md border-gray-300 cursor-pointer",onClick:()=>r(!0),children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md blur-sm opacity-60",src:"preview"in s?s.preview:s.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsxs("span",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2  text-2xl",children:["+",t.length-7]})]},"name"in s?s.name:s._id):e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:"preview"in s?s.preview:s.url.replace("/upload/","/upload/w_400,c_fill/"),alt:"Preview"}),e.jsx("button",{onClick:()=>g(s),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer hover:bg-gray-200 ",children:e.jsx(I,{})})]},"name"in s?s.name:s._id)),e.jsx(Q,{getRootProps:j,getInputProps:v})]})]})]}),e.jsx($,{open:l,onClose:P,style:H.style,children:e.jsx(pe,{combinedImages:t,handleRemoveImageFromFiles:g})})]})},ge=({register:l,errors:r,control:a,collections:c})=>{var i,o,u,p;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Product Details"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(S,{fullWidth:!0,label:"Name",size:"small",variant:"outlined",...l("name"),error:!!r.name,helperText:(i=r.name)==null?void 0:i.message}),e.jsx(S,{label:"Description",size:"small",multiline:!0,rows:4,...l("description"),error:!!r.description,helperText:(o=r.description)!=null&&o.message?String((u=r.description)==null?void 0:u.message):""}),e.jsx(xe,{}),e.jsxs(O,{fullWidth:!0,size:"small",error:!!r.category,children:[e.jsx(B,{error:!!r.category,children:"Category"}),e.jsx(M,{name:"category",control:a,render:({field:b})=>e.jsx(T,{labelId:"select-labesl",label:"Category",...b,variant:"outlined",children:c.map(t=>e.jsx(_,{value:t.id,children:t.name},t.id))})}),e.jsx(K,{children:((p=r.category)==null?void 0:p.message)||""})]})]})]})},he=({register:l,errors:r})=>{var a;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Inventory"}),e.jsx(S,{label:"Stock Quantity",variant:"outlined",size:"small",fullWidth:!0,type:"string",inputMode:"numeric",placeholder:"Enter quantity",...l("stockQuantity"),error:!!r.stockQuantity,helperText:(a=r.stockQuantity)==null?void 0:a.message})]})},je=({errors:l,control:r})=>{var a;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Status"}),e.jsxs(O,{fullWidth:!0,size:"small",error:!!l.status,children:[e.jsx(B,{error:!!l.status,children:"Status"}),e.jsx(M,{name:"status",control:r,render:({field:c})=>e.jsxs(T,{labelId:"select-labesl",label:"Status",...c,variant:"outlined",children:[e.jsx(_,{value:"Active",children:"Active"}),e.jsx(_,{value:"Inactive",children:"Inactive"})]})}),e.jsx(K,{children:((a=l.status)==null?void 0:a.message)||""})]})]})},ve=({register:l,errors:r,setValue:a})=>{var c;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Pricing"}),e.jsx(S,{label:"Price",variant:"outlined",size:"small",fullWidth:!0,slotProps:{input:{startAdornment:e.jsx(de,{position:"start",children:"â‚±"})}},placeholder:"Enter price",error:!!r.price,helperText:(c=r.price)==null?void 0:c.message,...l("price",{onBlur:i=>{const o=i.target.value,u=/^\d+(\.\d{1,2})?$/.test(o);if(o&&u&&!o.includes(".")){const p=`${o}.00`;i.target.value=p,a("price",p,{shouldValidate:!0})}}})})]})},be=({control:l})=>e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Featured Product"}),e.jsx(M,{name:"featured",control:l,render:({field:r})=>e.jsx(X,{...r,checked:r.value,icon:e.jsx("p",{className:"text-3xl",children:e.jsx(Z,{})}),checkedIcon:e.jsx("p",{className:"text-3xl",children:e.jsx(Y,{})})})})]})}),Pe=()=>{const{id:l}=ee(),r=se(),a=re(),c=y(n=>n.images),i=y(n=>n.clearImages),o=w(n=>n.images),u=w(n=>n.setInitialImages),p=w(n=>n.clearInitialImages),{collections:b}=ce(),{product:t}=ue(l||""),{update:j,isPending:v}=me(),P=te(n=>n.setOpenSnackBar);N.useEffect(()=>{u(t.images)},[t]);const g={name:t.name,description:t.description,category:t.category.id,price:JSON.stringify(t.price),status:t.status,stockQuantity:JSON.stringify(t.stockQuantity),featured:t.featured},{register:f,handleSubmit:C,setError:F,control:s,setValue:d,formState:{errors:h}}=ae({resolver:le(ne),defaultValues:g}),k=async n=>{var q,z;const E=!A.isEqual(g,n),R=t.images.map(x=>x.publicId).sort(),U=o.map(x=>x.publicId).sort(),W=!A.isEqual(R,U),V=c.length>0;if(!E&&!W&&!V){a("/products");return}const m=new FormData;c.forEach(x=>{m.append("image",x)}),o.forEach(x=>{m.append("images",x.publicId)}),m.append("name",n.name),m.append("description",n.description),m.append("featured",n.featured.toString()),m.append("status",n.status),m.append("price",n.price),m.append("category",n.category),m.append("stockQuantity",String(n.stockQuantity));try{await j({id:t.id,data:m}),await r.invalidateQueries({queryKey:["product",l]}),await r.invalidateQueries({queryKey:["products"],exact:!1}),await r.invalidateQueries({queryKey:["featuredProducts"],exact:!1}),await r.invalidateQueries({queryKey:["collections"],exact:!1}),await r.invalidateQueries({queryKey:["collection",n.category]}),await r.invalidateQueries({queryKey:["collection",t.category]}),P(!0),a("/products")}catch(x){F("root",{message:((z=(q=x.response)==null?void 0:q.data)==null?void 0:z.error)||"An unexpected error occurred"})}};return N.useEffect(()=>()=>{i(),p()},[i]),e.jsxs("form",{className:"w-full flex gap-5 justify-center",onSubmit:C(k),children:[e.jsxs("div",{className:"w-1/2 flex flex-col gap-4",children:[e.jsx(ge,{register:f,errors:h,control:s,collections:b}),e.jsx(he,{register:f,errors:h})]}),e.jsxs("div",{className:"w-1/3 flex flex-col gap-4",children:[e.jsx(be,{control:s}),e.jsx(je,{errors:h,control:s}),e.jsx(ve,{register:f,errors:h,setValue:d}),e.jsx(ie,{type:"submit",variant:"contained",size:"small",color:"primary",loading:v,children:"Save"}),h.root&&e.jsx("div",{className:"text-center text-red-600 ",children:h.root.message})]})]})};export{Pe as default};
