import{j as e,C as y,r as P,Q as v,B as E,P as Q,v as D,R as F,S as A,F as C,V as M,M as I,W as z,u as B,p as O,X as T,Y as q,Z as R,g as W,b as V,$ as K,x as L,y as $,a0 as U,D as k}from"./index-D1os0LSF.js";import{I as G}from"./InputAdornment-DMY7Iu_P.js";import{I as H,T as b,u as X}from"./useGetAllCollections-BCUxWnGR.js";import"./Typography-C35Fcnlr.js";const Y=({register:r,errors:s})=>{var n;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Inventory"}),e.jsx(y,{label:"Stock Quantity",variant:"outlined",size:"small",fullWidth:!0,type:"string",inputMode:"numeric",placeholder:"Enter quantity",...r("stockQuantity"),error:!!s.stockQuantity,helperText:(n=s.stockQuantity)==null?void 0:n.message})]})},Z=({register:r,errors:s,setValue:n})=>{var a;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Pricing"}),e.jsx(y,{label:"Price",variant:"outlined",size:"small",fullWidth:!0,slotProps:{input:{startAdornment:e.jsx(G,{position:"start",children:"â‚±"})}},placeholder:"Enter price",error:!!s.price,helperText:(a=s.price)==null?void 0:a.message,...r("price",{onBlur:o=>{const c=o.target.value,d=/^\d+(\.\d{1,2})?$/.test(c);if(c&&d&&!c.includes(".")){const m=`${c}.00`;o.target.value=m,n("price",m,{shouldValidate:!0})}}})})]})},S=({getRootProps:r,getInputProps:s})=>e.jsxs("div",{...r(),className:"w-20 border-2 border-dashed border-gray-300 p-5 cursor-pointer rounded-md flex items-center justify-center text-3xl hover:bg-gray-200",children:[e.jsx("input",{...s()}),e.jsx(H,{})]}),J=({files:r,handleRemoveImageFromFiles:s})=>e.jsx("div",{className:"overflow-y-auto h-full grid grid-cols-4 gap-5 p-4",children:r.map(n=>e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-32 object-cover rounded-md",src:n.preview,alt:"Preview"}),e.jsx("button",{onClick:()=>s(n.name),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer",children:e.jsx(b,{})})]},n.name))}),_=()=>{const[r,s]=P.useState(!1),n=()=>s(!1),a=v(t=>t.images),o=v(t=>t.setImages),c=v(t=>t.removeImage),[d,m]=P.useState(""),{getRootProps:x,getInputProps:i}=E({accept:{"image/*":[]},multiple:!0,maxSize:10*1024*1024,onDrop:(t,l)=>{l.length>0&&m("Some files were rejected. Ensure they are images and under 10MB.");const f=t.map(h=>Object.assign(h,{preview:URL.createObjectURL(h)})).filter(h=>!a.some(j=>j.name===h.name));o([...a,...f])}}),g=t=>{c(t)},p=a.length===1,w=a.length>1&&a.length<9,N=a.length>=9;return e.jsxs("div",{children:[e.jsx("p",{children:"Media: "}),e.jsxs("div",{className:"flex h-full flex-col gap-4",children:[a.length===0&&e.jsxs("div",{...x(),className:"border-2 border-dashed border-gray-300 p-5 cursor-pointer rounded-md text-center",children:[e.jsx("input",{...i(),accept:"image/*",max:"10485760"}),e.jsx("p",{className:"text-center",children:"Add at least 3 pictures"})]}),d&&e.jsx("p",{className:"text-red-500 italic text-center",children:d}),a.length>0&&e.jsxs("div",{className:"flex gap-2 h-50",children:[a.map((t,l)=>l===0&&e.jsxs("div",{className:"w-50 relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:t.preview,alt:"Preview"}),e.jsx("button",{onClick:()=>g(t.name),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer",children:e.jsx(b,{})})]},t.name)),p&&e.jsx("div",{children:e.jsx(S,{getRootProps:x,getInputProps:i})}),w&&e.jsxs("div",{className:"flex-1 grid grid-cols-4 grid-rows-2 gap-2",children:[a.map((t,l)=>l===0?null:e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:t.preview,alt:"Preview"}),e.jsx("button",{onClick:()=>g(t.name),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer hover:bg-gray-200 ",children:e.jsx(b,{})})]},t.name)),e.jsx(S,{getRootProps:x,getInputProps:i})]}),N&&e.jsxs("div",{className:"flex-1 grid grid-cols-4 grid-rows-2 gap-3",children:[a.map((t,l)=>l===0||l>=8?null:l===7?e.jsxs("div",{className:"w-full relative border rounded-md border-gray-300 cursor-pointer",onClick:()=>s(!0),children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md blur-sm opacity-60",src:t.preview,alt:"Preview"}),e.jsxs("span",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2  text-2xl",children:["+",a.length-7]})]},t.name):e.jsxs("div",{className:"w-full relative",children:[e.jsx("img",{className:"w-full h-full object-cover rounded-md",src:t.preview,alt:"Preview"}),e.jsx("button",{onClick:()=>g(t.name),className:"text-3xl bg-offwhite rounded-full hover:text-red-500 absolute -top-4 -right-4 cursor-pointer hover:bg-gray-200 ",children:e.jsx(b,{})})]},t.name)),e.jsx(S,{getRootProps:x,getInputProps:i})]})]})]}),e.jsx(Q,{open:r,onClose:n,style:D.style,children:e.jsx(J,{files:a,handleRemoveImageFromFiles:g})})]})},ee=({register:r,errors:s,control:n,collections:a})=>{var o,c,d,m;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Product Details"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(y,{fullWidth:!0,label:"Name",size:"small",variant:"outlined",...r("name"),error:!!s.name,helperText:(o=s.name)==null?void 0:o.message}),e.jsx(y,{label:"Description",size:"small",multiline:!0,rows:4,...r("description"),error:!!s.description,helperText:(c=s.description)!=null&&c.message?String((d=s.description)==null?void 0:d.message):""}),e.jsx(_,{}),e.jsxs(F,{fullWidth:!0,size:"small",error:!!s.category,children:[e.jsx(A,{error:!!s.category,children:"Category"}),e.jsx(C,{name:"category",control:n,render:({field:x})=>e.jsx(M,{labelId:"select-labesl",label:"Category",...x,variant:"outlined",children:a.map(i=>e.jsx(I,{value:i.id,children:i.name},i.id))})}),e.jsx(z,{children:((m=s.category)==null?void 0:m.message)||""})]})]})]})},se=({errors:r,control:s})=>{var n;return e.jsxs("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Status"}),e.jsxs(F,{fullWidth:!0,size:"small",error:!!r.status,children:[e.jsx(A,{error:!!r.status,children:"Status"}),e.jsx(C,{name:"status",control:s,render:({field:a})=>e.jsxs(M,{labelId:"select-labesl",label:"Status",...a,variant:"outlined",children:[e.jsx(I,{value:"Active",children:"Active"}),e.jsx(I,{value:"Inactive",children:"Inactive"})]})}),e.jsx(z,{children:((n=r.status)==null?void 0:n.message)||""})]})]})},re=()=>{const{mutateAsync:r,isPending:s,isError:n,error:a,isSuccess:o}=B({mutationFn:O.addProduct});return{addProduct:r,isPending:s,isError:n,error:a,isSuccess:o}},te=({control:r})=>e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg shadow-md",children:e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx("p",{className:"pb-2 font-semibold",children:"Featured Product"}),e.jsx(C,{name:"featured",control:r,render:({field:s})=>e.jsx(T,{...s,checked:s.value,icon:e.jsx("p",{className:"text-3xl",children:e.jsx(R,{})}),checkedIcon:e.jsx("p",{className:"text-3xl",children:e.jsx(q,{})})})})]})}),ce=()=>{const r=W(),{collections:s}=X(),n=V(),a=v(l=>l.images),o=v(l=>l.clearImages),c=K(l=>l.setOpenSnackBar),{register:d,handleSubmit:m,setError:x,control:i,setValue:g,formState:{errors:p}}=L({resolver:$(U),defaultValues:{featured:!1,category:"",status:"Active"}}),{addProduct:w,isPending:N}=re(),t=async l=>{var f,h;const u=new FormData;a.forEach(j=>{u.append("image",j)}),u.append("name",l.name),u.append("description",l.description),u.append("status",l.status),u.append("featured",l.featured.toString()),u.append("price",l.price),u.append("category",l.category),u.append("stockQuantity",String(l.stockQuantity));try{await w(u),await r.invalidateQueries({queryKey:["products"],exact:!1}),await r.invalidateQueries({queryKey:["featuredProducts"],exact:!1}),await r.invalidateQueries({queryKey:["collections"],exact:!1}),await r.invalidateQueries({queryKey:["dashboardsummary"]}),c(!0),n("/products")}catch(j){x("root",{message:((h=(f=j.response)==null?void 0:f.data)==null?void 0:h.error)||"An unexpected error occurred"})}};return P.useEffect(()=>()=>{o()},[o]),s.length===0?e.jsxs("div",{className:"border border-gray-300 shadow-md rounded-lg p-8 text-center mt-10 text-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No collections found"}),e.jsx("p",{className:"mb-4",children:"Please create a collection before adding a product."}),e.jsx(k,{variant:"contained",color:"ashblack",onClick:()=>n("/collections/addcollection"),children:"Create Collection"})]}):e.jsxs("form",{className:"w-full flex gap-5 justify-center",onSubmit:m(t),children:[e.jsxs("div",{className:"w-1/2 flex flex-col gap-4",children:[e.jsx(ee,{register:d,errors:p,control:i,collections:s}),e.jsx(Y,{register:d,errors:p})]}),e.jsxs("div",{className:"w-1/3 flex flex-col gap-4",children:[e.jsx(te,{control:i}),e.jsx(se,{errors:p,control:i}),e.jsx(Z,{register:d,errors:p,setValue:g}),e.jsx(k,{type:"submit",variant:"contained",size:"small",color:"primary",loading:N,children:"Save"}),p.root&&e.jsx("div",{className:"text-center text-red-600 ",children:p.root.message})]})]})};export{ce as default};
